#pragma once
#include "TaskFlag.h"

class ResultManager
{
private:
	//時間(タイミング)計測
	int time;
	//現在のフラグと次のフラグ
	int nowFlag;
	int nextFlag;

public:

	//初期化
	void Initialize()
	{
		time = 0;
		nowFlag = 0;
		nextFlag = 0;
	}

	//アニメーション変更時の処理
	void ChangeAnim(Fade& fade)
	{
		switch (nextFlag)
		{
		case 1:
			fade.ImageSet(PositionI(0, 0), "FadeImg", ML::Box2D(0, 0, 720, 405));
			fade.FadeSwitch(false, 50, 0.6f);
			break;

		case 5:
			fade.FadeSwitch(false, 120);
			break;

		default:
			break;
		}
		nowFlag = nextFlag;
	}

	//アニメーション処理
	bool Animation(Fade& fade, DI::VGamePad& in)
	{
		//現在のフラグと次のフラグが異なる場合
		if (nowFlag != nextFlag)
			ChangeAnim(fade);

		//基本的な処理はここに書け
		bool endFlag = false;
		switch (nowFlag)
		{
		case 0:
			++time;
			endFlag = time > 90;
			break;

		case 1:
			endFlag = fade.endFade;
			break;

		case 2:
			++time;
			endFlag = time > 70;
			break;

		case 3: //ここを今考えているのだよ君
				//クリアタイム(あるいは勝利プレイヤー)を表示して、
				//ボタン入力があったらタイトル画面に遷移してほしいのだよ君
			if (in.B1.down)
			{
				endFlag = true;
			}
			break;

		case 4:
			endFlag = true;
			break;
			
		case 5:
			if (fade.endFade)
				++time;
			endFlag = time > 60;
			break;

		default:
			break;
		}

		//フラグ遷移
		if (endFlag)
		{
			endFlag = false;
			time = 0;
			++nextFlag;

			if (nextFlag >= 6)
				return true;
		}
		return false;
	}
};